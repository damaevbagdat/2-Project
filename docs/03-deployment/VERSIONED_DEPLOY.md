# üöÄ –í–µ—Ä—Å–∏–æ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π Alash-Zan

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —Å –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å—é –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-github-secrets)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–Ω–∞-—Å–µ—Ä–≤–µ—Ä–µ)
- [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ–ø–ª–æ–π](#–∫–∞–∫-—Ä–∞–±–æ—Ç–∞–µ—Ç-–¥–µ–ø–ª–æ–π)
- [–û—Ç–∫–∞—Ç –≤–µ—Ä—Å–∏–∏](#–æ—Ç–∫–∞—Ç-–≤–µ—Ä—Å–∏–∏)
- [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–∞–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Ä–µ–ª–∏–∑–∞–º–∏)

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
GitHub (push to main)
    ‚Üì
GitHub Actions
    ‚Üì
Build –ø—Ä–æ–µ–∫—Ç–∞ (npm run build)
    ‚Üì
–£–ø–∞–∫–æ–≤–∫–∞ –≤ .tar.gz
    ‚Üì
SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä 194.32.142.237
    ‚Üì
–î–µ–ø–ª–æ–π –≤ /var/www/alash-zan/releases/[VERSION]/
    ‚Üì
–ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ symlink "current"
    ‚Üì
Nginx –æ—Ç–¥–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é (zero-downtime)
```

---

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

### 1. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á

SSH –∫–ª—é—á —É–∂–µ —Å–æ–∑–¥–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `~/.ssh/github-actions-alash-zan`

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i docs/03-deployment/Claude-Alash-Zan-key.pem ubuntu@194.32.142.237

# –í—ã–≤–µ—Å—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/github-actions-alash-zan
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –≤ GitHub Secrets

–ó–∞–π–¥–∏ –≤: **GitHub Repository ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions**

–°–æ–∑–¥–∞–π —Å–ª–µ–¥—É—é—â–∏–µ secrets:

| Secret Name | Value | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------|-------|----------|
| `SSH_PRIVATE_KEY` | `-----BEGIN OPENSSH PRIVATE KEY-----...` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏–∑ ~/.ssh/github-actions-alash-zan |
| `SERVER_HOST` | `194.32.142.237` | IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ |
| `SERVER_USER` | `ubuntu` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/var/www/alash-zan/
‚îú‚îÄ‚îÄ releases/                      # –í—Å–µ –≤–µ—Ä—Å–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ 2025-01-09_12-30-45_a1b2c3/  # –ü–æ timestamp + git hash
‚îÇ   ‚îú‚îÄ‚îÄ v1.0.0/                    # –ü–æ git tag
‚îÇ   ‚îú‚îÄ‚îÄ v1.1.0/
‚îÇ   ‚îî‚îÄ‚îÄ v1.2.0/                    # –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
‚îÇ
‚îú‚îÄ‚îÄ current -> releases/v1.2.0/    # Symlink –Ω–∞ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
‚îÇ
‚îî‚îÄ‚îÄ shared/                        # –û–±—â–∏–µ —Ñ–∞–π–ª—ã –º–µ–∂–¥—É —Ä–µ–ª–∏–∑–∞–º–∏
    ‚îú‚îÄ‚îÄ logs/                      # –õ–æ–≥–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
    ‚îî‚îÄ‚îÄ uploads/                   # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–∞–π–ª—ã
```

**Nginx —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞:** `/var/www/alash-zan/current/`

---

## üöÄ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ–ø–ª–æ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

**–ü—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ `main`:**

1. GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm ci`)
3. –°–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç (`npm run build`)
4. –°–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é:
   - –§–æ—Ä–º–∞—Ç: `YYYY-MM-DD_HH-MM-SS_<git-hash>`
   - –ü—Ä–∏–º–µ—Ä: `2025-01-09_15-30-45_a1b2c3d`
5. –£–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç `dist/` –≤ –∞—Ä—Ö–∏–≤
6. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH
7. –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –≤ `/var/www/alash-zan/releases/[VERSION]/`
8. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç symlink `current` –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
9. Nginx —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
10. –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ —Ä–µ–ª–∏–∑—ã (–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5)

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

**–ß–µ—Ä–µ–∑ GitHub Actions UI:**

1. –ó–∞–π–¥–∏ –≤ **Actions ‚Üí Deploy to Production**
2. –ù–∞–∂–º–∏ **Run workflow**
3. –£–∫–∞–∂–∏ –≤–µ—Ä—Å–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `v1.3.0`
4. –ù–∞–∂–º–∏ **Run workflow**

---

## ‚è™ –û—Ç–∫–∞—Ç –≤–µ—Ä—Å–∏–∏

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i docs/03-deployment/Claude-Alash-Zan-key.pem ubuntu@194.32.142.237

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –æ—Ç–∫–∞—Ç–∞
~/rollback-alash-zan.sh
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é
- Nginx —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é

### –û—Ç–∫–∞—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
~/rollback-alash-zan.sh

# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é
~/rollback-alash-zan.sh v1.0.0
```

### –û—Ç–∫–∞—Ç –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π (emergency)

```bash
ssh ubuntu@194.32.142.237 "ln -sfn releases/v1.0.0 /var/www/alash-zan/current"
```

---

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–∞–º–∏

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ä–µ–ª–∏–∑—ã

```bash
ssh ubuntu@194.32.142.237 "ls -lt /var/www/alash-zan/releases/"
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é

```bash
ssh ubuntu@194.32.142.237 "readlink /var/www/alash-zan/current"
```

### –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Ä–µ–ª–∏–∑ –≤—Ä—É—á–Ω—É—é

```bash
ssh ubuntu@194.32.142.237 "rm -rf /var/www/alash-zan/releases/v1.0.0"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ä–µ–ª–∏–∑–æ–≤.

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx:

```bash
# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nano /etc/nginx/sites-available/alash-zan.kz

# –î–æ–±–∞–≤–∏—Ç—å:
server {
    listen 80;
    server_name alash-zan.kz www.alash-zan.kz;

    root /var/www/alash-zan/current;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–∞–π—Ç
sudo ln -s /etc/nginx/sites-available/alash-zan.kz /etc/nginx/sites-enabled/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Nginx
sudo systemctl reload nginx
```

---

## üîí SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSL (Let's Encrypt)
sudo certbot --nginx -d alash-zan.kz -d www.alash-zan.kz

# –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ cron
```

---

## üìù –õ–æ–≥–∏ –¥–µ–ø–ª–æ—è

### GitHub Actions –ª–æ–≥–∏

GitHub ‚Üí Actions ‚Üí Deploy to Production ‚Üí –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫

### –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏

```bash
# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–ª–∏–∑–æ–≤
ls -lt /var/www/alash-zan/releases/
```

---

## ‚ö° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **Zero-downtime deployment** - —Å–∞–π—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
‚úÖ **Instant rollback** - –æ—Ç–∫–∞—Ç –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É
‚úÖ **Version history** - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –≤–µ—Ä—Å–∏–π
‚úÖ **Atomic deployment** - symlink –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ
‚úÖ **Automatic cleanup** - —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚úÖ **Git-integrated** - –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ git tags/commits

---

## üÜò Troubleshooting

### –î–µ–ø–ª–æ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GitHub Secrets (SSH_PRIVATE_KEY, SERVER_HOST, SERVER_USER)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
3. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ GitHub Actions

### –°–∞–π—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å symlink: `readlink /var/www/alash-zan/current`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–ª–∏–∑–∞: `ls -la /var/www/alash-zan/current/`
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Nginx: `sudo systemctl reload nginx`

### –ù—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è

```bash
# –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±
ssh ubuntu@194.32.142.237 "~/rollback-alash-zan.sh"
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 09 —è–Ω–≤–∞—Ä—è 2025
